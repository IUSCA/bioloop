version: "3"
services:
  ui:
    container_name: dgl_ui
    image: node:19
    volumes:
      - ./ui/:/opt/sca/app
      - dgl_ui_modules:/opt/sca/app/node_modules
    ports:
      - 127.0.0.1:443:443
    working_dir: /opt/sca/app
    command: sh -c "npm install && exec /opt/sca/app/node_modules/.bin/vite --host"
    # entrypoint: [ "tail", "-f", "/dev/null" ]

  api:
    container_name: dgl_api
    build:
      context: ./api
      args:
        APP_UID: ${APP_UID} # read from .env file
        APP_GID: ${APP_GID} # read from .env file
    volumes:
      - ./api/:/opt/sca/app
      - dgl_api_modules:/opt/sca/app/node_modules
    expose:
      - 3030
    ports:
      - 127.0.0.1:3030:3030
    # entrypoint: ["tail", "-f", "/dev/null"]
    extra_hosts:
      - "host.docker.internal:host-gateway" # for connecting to services running on localhost of the host network
    depends_on:
     - postgres

  postgres:
    container_name: dgl_postgres
    image: postgres:14.5
    # restart: unless-stopped
    environment:
      - POSTGRES_USER=dgluser
      - POSTGRES_PASSWORD=example
      - POSTGRES_DB=dgl
    volumes:
      - ./db/db_postgres:/var/lib/postgresql/data
      - ./postgres/scripts:/docker-entrypoint-initdb.d
    ports:
      - 127.0.0.1:5432:5432
    expose:
      - 5432


volumes:
  dgl_ui_modules:
    external: false

  dgl_api_modules:
    external: false
