generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model dataset {
  id               Int                 @id @default(autoincrement())
  name             String
  type             String
  num_directories  Int?
  num_files        Int?
  du_size          BigInt?
  size             BigInt?
  description      String?
  created_at       DateTime            @default(now()) @db.Timestamp(6)
  updated_at       DateTime            @default(now()) @updatedAt @db.Timestamp(6)
  origin_path      String?
  archive_path     String?
  is_deleted       Boolean             @default(false)
  metadata         Json?
  workflows        workflow[]
  files            dataset_file[]
  audit_logs       dataset_audit[]
  states           dataset_state[]
  derived_datasets dataset_hierarchy[] @relation("source_datasets")
  source_datasets  dataset_hierarchy[] @relation("derived_datasets")
  projects         project_dataset[]

  @@unique([name, type])
}

model dataset_hierarchy {
  source_id       Int
  derived_id      Int
  assigned_at     DateTime @default(now()) @db.Timestamp(6)
  source_dataset  dataset  @relation(name: "source_datasets", fields: [source_id], references: [id])
  derived_dataset dataset  @relation(name: "derived_datasets", fields: [derived_id], references: [id])

  @@id([source_id, derived_id])
}

model dataset_file {
  id         Int     @id @default(autoincrement())
  path       String
  md5        String?
  size       BigInt?
  filetype   String?
  metadata   Json?
  status     String?
  dataset_id Int
  dataset    dataset @relation(fields: [dataset_id], references: [id], onDelete: NoAction)

  @@index([dataset_id])
}

model dataset_audit {
  id         Int      @id @default(autoincrement())
  action     String
  timestamp  DateTime @default(now())
  old_data   Json?
  new_data   Json?
  user_id    Int?
  user       user?    @relation(fields: [user_id], references: [id])
  dataset_id Int
  dataset    dataset? @relation(fields: [dataset_id], references: [id])
}

model dataset_state {
  state      String
  timestamp  DateTime @default(now()) @db.Timestamp(6)
  metadata   Json?
  dataset_id Int
  dataset    dataset? @relation(fields: [dataset_id], references: [id])

  @@id([timestamp, dataset_id, state])
}

model user {
  id            Int             @id @default(autoincrement())
  username      String          @unique @db.VarChar(100)
  name          String?         @db.VarChar(100)
  email         String          @unique @db.VarChar(100)
  cas_id        String?         @unique @db.VarChar(100)
  notes         String?
  created_at    DateTime        @default(now()) @db.Timestamp(6)
  updated_at    DateTime        @default(now()) @updatedAt @db.Timestamp(6)
  is_deleted    Boolean         @default(false)
  user_role     user_role[]
  settings      user_settings?
  contacts      contact[]
  dataset_audit dataset_audit[]
  projects      project_user[]
  password      user_password?
  login         user_login?
}

model user_password {
  id         Int      @id @default(autoincrement())
  password   String   @db.VarChar(100)
  created_at DateTime @default(now()) @db.Timestamp(6)
  updated_at DateTime @default(now()) @updatedAt @db.Timestamp(6)
  user_id    Int      @unique
  user       user     @relation(fields: [user_id], references: [id])
}

model user_login {
  id         Int      @id @default(autoincrement())
  last_login DateTime @default(now()) @db.Timestamp(6)
  method     String
  user_id    Int      @unique
  user       user     @relation(fields: [user_id], references: [id])
}

model user_settings {
  id       Int  @id @default(autoincrement())
  user_id  Int  @unique
  settings Json
  users    user @relation(fields: [user_id], references: [id], onDelete: NoAction)
}

model contact {
  id          Int               @id @default(autoincrement())
  type        String
  value       String
  description String?
  user_id     Int?
  user        user?             @relation(fields: [user_id], references: [id], onDelete: NoAction)
  projects    project_contact[]

  @@unique([type, value])
}

model role {
  id          Int         @id @default(autoincrement())
  name        String      @db.VarChar(50)
  description String      @default("") @db.VarChar(255)
  user_role   user_role[]
}

model user_role {
  user_id     Int
  role_id     Int
  roles       role     @relation(fields: [role_id], references: [id])
  users       user     @relation(fields: [user_id], references: [id])
  assigned_at DateTime @default(now())

  @@id([user_id, role_id])
}

model workflow {
  id         String   @id
  dataset_id Int?
  dataset    dataset? @relation(fields: [dataset_id], references: [id], onDelete: NoAction)
}

model metric {
  timestamp   DateTime @default(now()) @db.Timestamp(6)
  measurement String
  subject     String
  usage       BigInt?
  limit       BigInt?
  fields      Json?
  tags        Json?

  @@id([timestamp, measurement, subject])
}

model project {
  id              String            @id @default(uuid())
  slug            String            @unique
  name            String
  description     String?
  browser_enabled Boolean           @default(false)
  funding         String?
  metadata        Json?
  created_at      DateTime          @default(now()) @db.Timestamp(6)
  updated_at      DateTime          @default(now()) @updatedAt @db.Timestamp(6)
  users           project_user[]
  datasets        project_dataset[]
  contacts        project_contact[]
}

model project_user {
  project_id  String
  user_id     Int
  assigned_at DateTime @default(now()) @db.Timestamp(6)
  project     project  @relation(fields: [project_id], references: [id], onDelete: Cascade)
  user        user     @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@id([project_id, user_id])
}

model project_dataset {
  project_id  String
  dataset_id  Int
  assigned_at DateTime @default(now()) @db.Timestamp(6)
  project     project  @relation(fields: [project_id], references: [id], onDelete: Cascade)
  dataset     dataset  @relation(fields: [dataset_id], references: [id], onDelete: Cascade)

  @@id([project_id, dataset_id])
}

model project_contact {
  project_id  String
  contact_id  Int
  assigned_at DateTime @default(now()) @db.Timestamp(6)
  project     project  @relation(fields: [project_id], references: [id], onDelete: Cascade)
  contact     contact  @relation(fields: [contact_id], references: [id], onDelete: Cascade)

  @@id([project_id, contact_id])
}

model adni_subject {
  main_id             String       @id
  subject_id          String
  num_images          Int?
  num_as_dx_dasc      Int?
  num_as_dx_dsbc      Int?
  adni_imaging        adni_imaging[]
  as_dx_dasc          as_dx_dasc[]
}

model adni_imaging {
  adni_subject        adni_subject @relation(fields: [main_id], references: [main_id])
  aimg_id             String       @id
  main_id             String
  image_id            String       
  rid                 String?
  tid                 String?
  project             String?
  phase               String?
  sex                 String?
  weight              String?
  research_group      String?
  apoe_a1             String?
  apoe_a2             String?
  visit               String?
  study_date          String?
  archive_date        String?
  age                 String?
  global_cdr          String?
  npiq_total_score    String?
  mmse_total_score    String?
  gdscale_total_score String?
  faq_total_score     String?
  modality            String?
  description         String?
  type                String?
  imaging_protocol    String?
  structure           String?
  laterality          String?
  image_type          String?
  registration        String?
  tissue              String?
}

model as_dx_dasc {
	adni_subject    adni_subject @relation(fields: [main_id], references: [main_id])
  as_dx_dasc_id   String       @id
	main_id         String
  rid 			      String
	site_id 		    String?
	vis_code 		    String?
	vis_code2 		  String?
	user_date 		  String?
	user_date2 		  String?
	exam_date 		  String?
	ax_nausea 		  String?
	ax_vomit 		    String?
	ax_diarrh 		  String?
	ax_constp 		  String?
	ax_abdomn 		  String?
	ax_sweatn 		  String?
	ax_dizzy 		    String?
	ax_energy 		  String?
	ax_drowsy 		  String?
	ax_vision 		  String?
	ax_hdache 		  String?
	ax_drymth 		  String?
	ax_breath 		  String?
	ax_cough 		    String?
	ax_palpit 		  String?
	ax_chest 		    String?
	ax_urndis 		  String?
	ax_urnfrq 		  String?
	ax_ankle 		    String?
	ax_muscle 		  String?
	ax_rash 		    String?
	ax_insomn 		  String?
	ax_dpmood 		  String?
	ax_crying 		  String?
	ax_elmood 		  String?
	ax_wander 		  String?
	ax_fall 		    String?
	ax_other 		    String?
	ax_specif 		  String?
	update_stamp 	  String?
}

